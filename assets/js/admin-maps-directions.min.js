/**
 *  Maps Directions
 *
 *  @description: Adds directions functionality to the maps builder
 *  @copyright: http://opensource.org/licenses/gpl-2.0.php GNU Public License
 *  @since: 2.0
 */
var gmb_data;!function(e){"use strict";/**
	 * Setup Directions Autocomplete Field
	 *
	 * @param element
	 * @returns {boolean}
	 */
function t(t){if("undefined"==typeof t[0])return!1;var r=new google.maps.places.Autocomplete(t[0]);r.bindTo("bounds",map),
//Tame the enter key to not save the post while using the dirs_autocomplete input
google.maps.event.addDomListener(t[0],"keydown",function(e){13==e.keyCode&&e.preventDefault()}),
//Autocomplete event listener
google.maps.event.addListener(r,"place_changed",function(){
//get place information
//Set appropriate field vars
//set lat lng input values
//Add new row
//$( element ).parents( '.cmb-type-destination' ).find( '.cmb-add-row-button' ).trigger( 'click' );
return n=r.getPlace(),o=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-latitude"),a=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-longitude"),d=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-place_id"),o.val(n.geometry.location.lat()),a.val(n.geometry.location.lng()),d.val(n.place_id),n.geometry?void i():void alert("Error: Place not found!")})}/**
	 * Calculate Route
	 */
function i(){
//Loop through Directions group
e("#gmb_directions_group_repeat").find(".cmb-repeatable-grouping").each(function(t,i){r[t]&&r[t].setMap(null);var n=new google.maps.DirectionsService;r[t]=new google.maps.DirectionsRenderer,r[t].setMap(window.map);
//Next loop through the groups within
var o=e(this).find(".cmb-repeat-row"),a=o.first().find('.gmb-directions-latitude[data-iterator="0"]').val(),d=o.first().find('.gmb-directions-longitude[data-iterator="0"]').val(),s=o.last().find(".gmb-directions-latitude").val(),l=o.last().find(".gmb-directions-longitude").val(),c=e(this).find(".gmb-travel-mode").val(),g=[];o.not(":first").not(":last").each(function(t,i){var n=e(this).find(".gmb-directions-latitude").val(),o=e(this).find(".gmb-directions-longitude").val();g.push({location:n+","+o,stopover:!0})});var m={origin:a+","+d,destination:s+","+l,waypoints:g,optimizeWaypoints:!0,travelMode:google.maps.TravelMode[c]};n.route(m,function(e,i){if(i==google.maps.DirectionsStatus.OK){
//directionsDisplay[index].setOptions( {preserveViewport: true} );
r[t].setDirections(e);{e.routes[0]}}})})}var n,o,a,d,r=[];/**
	 * Kick it off on Window Load
	 */
e(window).on("load",function(){
//Calculate the route here
i(),
//Setup autocomplete for each input
e(".gmb-directions-autocomplete").each(function(i,n){t(e(this))}),
//Destination added
e("#gmb_directions_group_repeat").on("cmb2_add_row",function(i,n){t(e(n).find(".gmb-directions-autocomplete"))}),
//Destination row removed
e(".cmb-type-destination").on("cmb2_remove_row",function(e,t){i()}),
//Destination row removed
e("body").on("change",".gmb-travel-mode",function(e,t){i()})})}(jQuery);