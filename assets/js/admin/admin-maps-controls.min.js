var gmb_data,gmb_upload_marker,trafficLayer=new google.maps.TrafficLayer,transitLayer=new google.maps.TransitLayer,bicycleLayer=new google.maps.BicyclingLayer,placeSearchAutocomplete;!function(e){"use strict";function t(e){if(!e)return!1;var t=e.val(),a=e.prop("checked");switch(t){case"traffic":trafficLayer.setMap(a?window.map:null);break;case"transit":transitLayer.setMap(a?window.map:null);break;case"bicycle":bicycleLayer.setMap(a?window.map:null)}}function a(t){"undefined"==typeof placeSearchAutocomplete&&t.prop("checked")===!0?(o(),e("#places-search").show()):t.prop("checked")===!0&&"object"==typeof placeSearchAutocomplete?e("#places-search").show():e("#places-search").hide()}function o(){function e(e,t){var a=document.getElementById(e);google.maps.event.addDomListener(a,"click",function(){placeSearchAutocomplete.setTypes(t)})}{var t=document.getElementById("pac-input");document.getElementById("type-selector")}map.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("places-search")),placeSearchAutocomplete=new google.maps.places.Autocomplete(t),placeSearchAutocomplete.bindTo("bounds",map);var a=new google.maps.InfoWindow,o=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(placeSearchAutocomplete,"place_changed",function(){a.close(),o.setVisible(!1);var e=placeSearchAutocomplete.getPlace();if(!e.geometry)return void window.alert("Autocomplete's returned place contains no geometry");e.geometry.viewport?map.fitBounds(e.geometry.viewport):(map.setCenter(e.geometry.location),map.setZoom(17)),o.setIcon({url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),o.setPosition(e.geometry.location),o.setVisible(!0);var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),a.setContent("<div><strong>"+e.name+"</strong><br>"+t),a.open(map,o)}),e("changetype-all",[]),e("changetype-address",["address"]),e("changetype-establishment",["establishment"]),e("changetype-geocode",["geocode"]),google.maps.event.addDomListener(t,"keydown",function(e){13==e.keyCode&&e.preventDefault()})}function n(){var t=e(".map-autocomplete-wrap"),a=e("#map-location-autocomplete").get(0),o=new google.maps.places.Autocomplete(a);o.bindTo("bounds",map),google.maps.event.addListener(o,"place_changed",function(){var a=o.getPlace();return a.geometry?(a.geometry.viewport?map.fitBounds(a.geometry.viewport):(map.setCenter(a.geometry.location),map.setZoom(17)),e(t).find(".mfp-close").trigger("click"),void i(t)):void window.alert("Autocomplete's returned place contains no geometry")}),google.maps.event.addDomListener(a,"keydown",function(e){13==e.keyCode&&e.preventDefault()})}function i(t){e(t).addClass("mfp-hide").appendTo(".modal-placeholder").unwrap()}function r(){e(".edit-title").on("click",function(){e("#modal_title").val(e("input#title").val()).focus()}),e("#modal_title").on("blur",function(){e("input#title").val(e(this).val())})}function l(){var t=e(".lat-lng-update-btn"),a=e(".update-lat-lng"),o=map.getCenter();e(".live-latitude").text(o.lat()),e(".live-longitude").text(o.lng()),a.attr("data-lat",o.lat()),e(".lat-lng-change-message").slideDown(),a.attr("data-lng",o.lng()),t.attr("data-lat",o.lat()),t.attr("data-lng",o.lng()),t.removeAttr("disabled"),a.removeAttr("disabled")}e(window).on("load",function(){e(".cmb2-id-gmb-layers input").on("change",function(){t(e(this))}),e(".cmb2-id-gmb-layers input:checkbox").each(function(){t(e(this))});var o=e(".cmb2-id-gmb-places-search input");o.on("change",function(){a(e(this))}),a(o),n(),r(),google.maps.event.addListener(map,"drag",function(){l()}),google.maps.event.addListener(map,"dragend",function(){l()}),google.maps.event.addListener(map,"zoom_changed",function(){l()}),e("body").on("click",".gmb-magnific-inline",function(t){t.preventDefault();var a="."+e(this).data("target"),o=e(this).data("auto-focus");if(e.magnificPopup.instance.isOpen===!0){e(a).before('<div class="modal-placeholder"></div>').removeClass("mfp-hide").appendTo(".magnific-builder #poststuff");var n=e(a).find(".inner-modal-wrap"),r=e(a).find(".inner-modal-container");0==n.length&&0==r.length&&(e(a).addClass("white-popup").wrapInner('<div class="inner-modal-wrap"><div class="inner-modal-container"><div class="inner-modal clearfix"></div></div></div>'),e('<button type="button" class="gmb-modal-close">&times;</button>').prependTo(e(a).find(".inner-modal"))),e(a).on("click",function(t){(e(t.target).hasClass("inner-modal-wrap")||e(t.target).hasClass("inner-modal-container"))&&i(a)}),e(".gmb-modal-close").on("click",function(){i(a)}),1==o&&e(a).find('input[type="text"]').focus()}else e.magnificPopup.open({callbacks:{beforeOpen:function(){e(a).addClass("white-popup")}},items:{src:e(a),type:"inline"},midClick:!0})}),gmb_upload_marker={uploader:function(){var e=wp.media({title:"Set an Custom Marker Icon",multiple:!1,library:{type:"image"},button:{text:"Set Marker"}});return e.on("close",function(){var t=e.state().get("selection").toJSON();gmb_upload_marker.render(t[0])}),e.open(),!1},render:function(t){e(".gmb-image-preview").prepend(gmb_upload_marker.imgHTML(t)),e(".gmb-image-preview").html(gmb_upload_marker.imgHTML(t)),e(".gmb-image-preview").show(),e(".save-marker-icon").slideDown(),e(".save-marker-button").data("marker-image",t.url)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',""!=e.alt&&(t+='alt="'+e.alt+'" '),t+="/>"},removeImage:function(t){e("#"+t+"attachment_id").val(""),e("#"+t+"imageurl").val(""),e("#"+t+"preview img").remove(),e("#"+t+"preview a").hide()}}})}(jQuery);