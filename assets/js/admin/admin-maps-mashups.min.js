window.GMB_Mashups=function(e,t,a,o){"use strict";var n,s,r,i,m={},p=[];return m.cache=function(){},m.init=function(){m.cache(),a("body").on("change",".gmb-mashup-post-type-field select",m.toggle_mashup_taxonomies),a("body").on("change",".cmb-type-select-taxonomies select",m.toggle_mashup_terms),a("body").on("click",".gmb-load-mashup",m.toggle_mashup_loading),a("body").on("change",".cmb-repeatable-grouping select, .cmb-repeatable-grouping input:not(hidden)",function(){a(this).parents(".cmb-repeatable-grouping").find(".gmb-load-mashup").addClass("button-primary").removeAttr("disabled")})},m.toggle_mashup_taxonomies=function(){var e=a(this),t=e.val(),o=e.parents(".cmb-repeatable-grouping").data("iterator"),n=a(this).parents(".gmb-mashup-post-type-field").next(".gmb-taxonomy-select-field"),s=n.find("select"),r=a(this).parents(".gmb-mashup-post-type-field").nextAll(".gmb-terms-multicheck-field");n.hide(),r.hide();var i={action:"get_post_types_taxonomies",post_type:t,index:o};jQuery.post(ajaxurl,i,function(e){var t=jQuery.parseJSON(e);s.empty().html(t.options),n.show(),"none"!==t.status&&(r.find(".cmb2-checkbox-list").empty().html(t.terms_checklist),r.show())})},m.toggle_mashup_terms=function(){var e=a(this),t=e.val(),o=e.parents(".cmb-repeatable-grouping").data("iterator"),n=a(this).parents(".cmb-repeatable-grouping").find(".gmb-terms-multicheck-field");n.hide();var s={action:"get_taxonomy_terms",taxonomy:t,index:o};jQuery.post(ajaxurl,s,function(e){var t=jQuery.parseJSON(e);n.find(".cmb2-checkbox-list").empty().html(t.terms_checklist),n.show()})},m.toggle_mashup_loading=function(e){e.preventDefault();var t=a(this),o=t.parents(".cmb-repeatable-grouping").data("iterator"),n=a("#gmb_mashup_group_"+o+"_post_type").val(),s=a("#gmb_mashup_group_"+o+"_taxonomy").val(),r=[];a(".cmb2-id-gmb-mashup-group-"+o+"-terms").find('input[type="checkbox"]:checked').each(function(e){r[e]=a(this).val()});var i={action:"get_mashup_markers",post_type:n,taxonomy:s,terms:r,index:o};jQuery.post(ajaxurl,i,function(e){return"undefined"!=typeof e.error?(alert(e.error),!1):(m.clear_mashup_markers(i.index),p[i.index]=[],a.each(e,function(e,t){m.set_mashup_marker(i.index,t)}),t.prev("#mashup_configured").val(!0),void t.removeClass("button-primary").attr("disabled","disabled"))},"json")},m.set_mashup_marker=function(t,a){n="undefined"!=typeof a.all_custom._gmb_address?a.all_custom._gmb_address[0]:"",s="undefined"!=typeof a.all_custom._gmb_lat?a.all_custom._gmb_lat[0]:"",r="undefined"!=typeof a.all_custom._gmb_lng?a.all_custom._gmb_lng[0]:"",i=new google.maps.Marker({map:e.map,position:new google.maps.LatLng(s,r)}),p[t].push(i)},m.clear_mashup_markers=function(e){if("undefined"!=typeof p[e])for(var t=0;t<p[e].length;t++)p[e][t].setMap(null)},a(t).ready(m.init),m}(window,document,jQuery);