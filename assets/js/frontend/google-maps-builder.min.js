var gmb_data;!function($){"use strict";function load_hidden_map(e){var a=$(e).find(".google-maps-builder");a.length&&a.each(function(e,t){initialize_map($(a[e]))})}function initialize_map(e){var a=$(e).data("map-id"),t=gmb_data[a];info_window=new InfoBubble(info_window_args);var n=t.map_params.latitude?t.map_params.latitude:"32.713240",o=t.map_params.longitude?t.map_params.longitude:"-117.159443",r={center:new google.maps.LatLng(n,o),zoom:parseInt(t.map_params.zoom),styles:[{stylers:[{visibility:"simplified"}]},{elementType:"labels",stylers:[{visibility:"off"}]}]};map=new google.maps.Map(e[0],r),info_window_args.map=map,places_service=new google.maps.places.PlacesService(map),set_map_options(map,t),set_map_theme(map,t),set_map_markers(map,t,info_window),set_mashup_markers(map,t),set_map_directions(map,t),set_map_layers(map,t),set_map_places_search(map,t),"yes"===t.places_api.show_places&&perform_places_search(map,t,info_window)}function set_map_theme(map,map_data){var map_type=map_data.map_theme.map_type.toUpperCase(),map_theme=map_data.map_theme.map_theme_json;"ROADMAP"===map_type&&"none"!==map_theme?map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP,styles:eval(map_theme)}):map.setOptions({mapTypeId:google.maps.MapTypeId[map_type],styles:!1})}function set_map_options(e,a){var t=a.map_controls.zoom_control.toLowerCase();"none"==t?e.setOptions({zoomControl:!1}):e.setOptions({zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle[t]}});var n=a.map_controls.wheel_zoom.toLowerCase();"none"===n?e.setOptions({scrollwheel:!1}):e.setOptions({scrollwheel:!0});var o=a.map_controls.pan_control.toLowerCase();"none"===o?e.setOptions({panControl:!1}):e.setOptions({panControl:!0});var r=a.map_controls.street_view.toLowerCase();"none"===r?e.setOptions({streetViewControl:!1}):e.setOptions({streetViewControl:!0});var i=a.map_controls.double_click_zoom.toLowerCase();"none"===i?e.setOptions({disableDoubleClickZoom:!0}):e.setOptions({disableDoubleClickZoom:!1});var s=a.map_controls.draggable.toLowerCase();"none"===s?e.setOptions({draggable:!1}):e.setOptions({draggable:!0})}function set_map_markers(map,map_data,info_window){var map_markers=map_data.map_markers,markers=[];if($(map_markers).each(function(index,marker_data){if(""!=marker_data.lat&&""!=marker_data.lng){var marker_label="",marker_icon=map_data.map_params.default_marker;marker_data.marker_img?marker_icon=marker_data.marker_img:"undefined"!=typeof marker_data.marker&&marker_data.marker.length>0&&"undefined"!=typeof marker_data.label&&marker_data.label.length>0&&(marker_icon=eval("("+marker_data.marker+")"),marker_label=marker_data.label);var marker_args={position:new google.maps.LatLng(marker_data.lat,marker_data.lng),map:map,zIndex:index,icon:marker_icon,custom_label:marker_label};marker_data.place_id&&"enabled"===map_data.signed_in_option&&(delete marker_args.position,marker_args.place={location:{lat:parseFloat(marker_data.lat),lng:parseFloat(marker_data.lng)},placeId:marker_data.place_id},marker_args.attribution={source:map_data.site_name,webUrl:map_data.site_url});var location_marker=new Marker(marker_args);markers.push(location_marker),location_marker.setVisible(!0),google.maps.event.addListener(location_marker,"click",function(){set_info_window_content(marker_data,info_window),info_window.open(map,location_marker),info_window.updateContent_(),"yes"==map_data.marker_centered&&window.setTimeout(function(){info_window.panToView()},200)}),"undefined"!=typeof marker_data.infowindow_open&&"opened"==marker_data.infowindow_open&&google.maps.event.addListenerOnce(map,"idle",function(){info_window.setContent('<div id="infobubble-content" class="loading"></div>'),set_info_window_content(marker_data,info_window),info_window.open(map,location_marker),info_window.updateContent_()})}}),"yes"===map_data.marker_cluster)var markerCluster=new MarkerClusterer(map,markers)}function set_info_window_content(e,a){var t;if(e.title&&(t='<p class="place-title">'+e.title+"</p>"),e.description&&(t+='<div class="place-description">'+e.description+"</div>"),e.place_id&&"on"!==e.hide_details){var n={key:gmb_data.api_key,placeId:e.place_id};places_service.getDetails(n,function(e,n){n==google.maps.places.PlacesServiceStatus.OK&&(t+=set_place_content_in_info_window(e),a.setContent(t),a.updateContent_())})}else a.setContent(t),a.updateContent_()}function set_place_content_in_info_window(e){var a;return a='<div class="marker-info-wrapper">',a+=e.formatted_address?'<div class="place-address">'+e.formatted_address+"</div>":"",a+=e.formatted_phone_number?'<div class="place-phone">'+e.formatted_phone_number+"</div>":"",a+=e.website?'<div class="place-website"><a href="'+e.website+'" target="_blank" rel="nofollow" title="Click to visit the '+e.name+' website">Website</a></div>':"",e.rating&&(a+='<div class="rating-wrap clear"><p class="numeric-rating">'+e.rating+'</p><div class="star-rating-wrap"><div class="star-rating-size" style="width:'+65*e.rating/5+'px;"></div></div></div>'),a+="</div>"}function perform_places_search(e,a,t){for(var n=e.getCenter(),o=a.places_api.search_places,r=0;r<search_markers.length;r++)search_markers[r].setMap(null);if(search_markers=[],o.length>0){var i={key:gmb_data.api_key,location:new google.maps.LatLng(n.lat(),n.lng()),types:o,radius:a.places_api.search_radius};places_service.nearbySearch(i,function(a,n,o){var r,i=0;if(n==google.maps.places.PlacesServiceStatus.OK){for(i=0;r=a[i];i++)create_search_result_marker(e,a[i],t);o.hasNextPage&&o.nextPage()}})}}function create_search_result_marker(e,a,t){var n=new google.maps.Marker({map:e});n.setIcon({url:a.icon,size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(24,24)}),n.setPosition(a.geometry.location),n.setVisible(!0),google.maps.event.addListener(n,"click",function(){t.close(),t.setContent('<div class="gmb-infobubble loading"></div>');var o={title:a.name,place_id:a.place_id};set_info_window_content(o,t),t.open(e,n)}),search_markers.push(n)}function set_mashup_markers(e,a){if("undefined"==typeof a.mashup_markers||!a.mashup_markers)return!1;var t=[];$(a.mashup_markers).each(function(n,o){var r="undefined"!=typeof o.post_type?o.post_type:"",i="undefined"!=typeof o.taxonomy?o.taxonomy:"",s="undefined"!=typeof o.latitude?o.latitude:"",l="undefined"!=typeof o.longitude?o.longitude:"",m="undefined"!=typeof o.terms?o.terms:"",p={action:"get_mashup_markers",post_type:r,taxonomy:i,terms:m,index:n,lat_field:s,lng_field:l};jQuery.post(a.ajax_url,p,function(n){if($.each(n,function(n,r){var i=set_mashup_marker(e,p.index,r,o,a);i instanceof Marker&&t.push(i)}),"yes"===a.marker_cluster){new MarkerClusterer(e,t)}},"json")})}function set_mashup_marker(map,mashup_index,marker_data,mashup_value,map_data){var lat="undefined"!=typeof marker_data.latitude?marker_data.latitude:"",lng="undefined"!=typeof marker_data.longitude?marker_data.longitude:"";if(""==lat||""==lng)return!1;var title="undefined"!=typeof marker_data.title?marker_data.title:"",address="undefined"!=typeof marker_data.address?marker_data.address:"",marker_position=new google.maps.LatLng(lat,lng),marker_icon=map_data.map_params.default_marker,marker_label="",custom_marker_icon="undefined"!=typeof mashup_value.marker?mashup_value.marker:"",custom_marker_img="undefined"!=typeof mashup_value.marker_img?mashup_value.marker_img:"";if(custom_marker_img)marker_icon=custom_marker_img;else if(custom_marker_icon.length>0&&custom_marker_icon.length>0){var custom_label="undefined"!=typeof mashup_value.label?mashup_value.label:"";marker_icon=eval("("+custom_marker_icon+")"),marker_label=custom_label}var marker=new Marker({map:map,position:marker_position,marker_data:marker_data,icon:marker_icon,custom_label:marker_label});return google.maps.event.addListener(marker,"click",function(){get_mashup_infowindow_content(map,marker,map_data)}),marker}function get_mashup_infowindow_content(e,a,t){info_window.setContent('<div class="gmb-infobubble loading"></div>'),info_window.open(e,a);var n={action:"get_mashup_marker_infowindow",marker_data:a.marker_data,featured_img:a.featured_img};jQuery.post(t.ajax_url,n,function(e){info_window.setContent(e.infowindow),info_window.updateContent_(),"yes"==t.marker_centered&&window.setTimeout(function(){info_window.panToView()},200)},"json")}function set_map_directions(e,a){$(a.destination_markers).each(function(t,n){var o=new google.maps.DirectionsService,r=new google.maps.DirectionsRenderer,i=$("#directions-panel-"+a.id).find(".gmb-directions-panel-inner");if("undefined"==typeof n.point||"undefined"==typeof n.point[0])return!1;r.setMap(e),"none"!==a.text_directions&&r.setPanel($(i).get(0));var s,l=n.point[0].latitude,m=n.point[0].longitude,p=n.point[0].address;s=p?p:l+","+m;var d,_=n.point[n.point.length-1].latitude,c=n.point[n.point.length-1].longitude,g=n.point[n.point.length-1].address;d=g?g:_+","+c;var u=n.travel_mode.length>0?n.travel_mode:"DRIVING",f=[];$(n.point.slice(1,-1)).each(function(e,a){var t,n=a.latitude,o=a.longitude,r=a.address;t=r?r:n+","+o,f.push({location:t,stopover:!0})});var k={origin:s,destination:d,waypoints:f,optimizeWaypoints:!0,travelMode:google.maps.TravelMode[u]};o.route(k,function(e,a){a==google.maps.DirectionsStatus.OK&&(r.setOptions({preserveViewport:!0}),r.setDirections(e))})}),$("#directions-panel-"+a.id).find(".gmb-directions-toggle").on("click",function(e){e.preventDefault();var a=$(this).parent(".gmb-directions-panel");a.hasClass("toggled")?a.removeClass("toggled").animate({right:"-50%"}):a.addClass("toggled").animate({right:"0%"})})}function set_map_layers(e,a){var t=new google.maps.TrafficLayer,n=new google.maps.TransitLayer,o=new google.maps.BicyclingLayer;$(a.layers).each(function(a,r){switch(r){case"traffic":t.setMap(e);break;case"transit":n.setMap(e);break;case"bicycle":o.setMap(e)}})}function set_map_places_search(e,a){function t(e,a){var t=document.getElementById(e);google.maps.event.addDomListener(t,"click",function(){r.setTypes(a)})}if("yes"!==a.places_search[0])return!1;var n=$("#google-maps-builder-"+a.id).siblings(".places-search-wrap"),o=n.find("#pac-input").get(0);$("#google-maps-builder-"+a.id).siblings(".places-search-wrap").find("#type-selector").get(0);e.controls[google.maps.ControlPosition.TOP_CENTER].push(n.get(0));var r=new google.maps.places.Autocomplete(o);r.bindTo("bounds",e);var i=new InfoBubble,s=new google.maps.Marker({map:e,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(r,"place_changed",function(){i.close(),s.setVisible(!1);var a=r.getPlace();if(!a.geometry)return void window.alert("Autocomplete's returned place contains no geometry");a.geometry.viewport?e.fitBounds(a.geometry.viewport):(e.setCenter(a.geometry.location),e.setZoom(17)),s.setIcon({url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),s.setPosition(a.geometry.location),s.setVisible(!0);var t;a.name&&(t='<p class="place-title">'+a.name+"</p>"),t+=set_place_content_in_info_window(a),i.setContent(t),i.open(e,s)}),t("changetype-all",[]),t("changetype-address",["address"]),t("changetype-establishment",["establishment"]),t("changetype-geocode",["geocode"])}var map,places_service,place,info_window,directionsDisplay=[],search_markers=[],info_window_args={map:map,shadowStyle:0,padding:0,backgroundColor:"rgb(255, 255, 255)",borderRadius:3,arrowSize:15,minHeight:100,maxHeight:355,minWidth:220,maxWidth:355,borderWidth:0,disableAutoPan:!0,backgroundClassName:"gmb-infobubble"};window.google_maps_builder_load=function(e){return $(e).hasClass("google-maps-builder")?void initialize_map(e):"invalid Google Maps Builder"},$(document).ready(function(){var e=$(".google-maps-builder");e.each(function(a,t){initialize_map($(e[a]))}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var a=$(e.target).attr("href");load_hidden_map(a)}),$(".fl-tabs-label").on("click",function(e){var a=$(".fl-tabs-panel-content.fl-tab-active").get(0);load_hidden_map(a)}),$(".responsive-tabs__list__item").on("click",function(e){var a=$(".responsive-tabs__panel--active").get(0);load_hidden_map(a)}),$(".ui-accordion-header").on("click",function(e){var a=$(".ui-accordion-content-active").get(0);load_hidden_map(a)})})}(jQuery);