/**
 * Maps Builder JS
 *
 * @description: Frontend form rendering
 */
var gmb_data;!function($){"use strict";/**
	 * Map Init After the fact
	 *
	 * Good for tabs / ajax - pass in wrapper div class/id
	 *
	 */
function load_hidden_map(e){var a=$(e+" .google-maps-builder");a.length&&a.each(function(e,o){initialize_map($(a[e]))})}/**
	 * Map Intialize
	 *
	 * Sets up and configures the Google Map
	 *
	 * @param map_canvas
	 */
function initialize_map(e){
//info_window - Contains the place's information and content
var a=new google.maps.InfoWindow({maxWidth:315}),o=$(e).data("map-id"),t=gmb_data[o],n=t.map_params.latitude?t.map_params.latitude:"32.713240",i=t.map_params.longitude?t.map_params.longitude:"-117.159443",r={center:new google.maps.LatLng(n,i),zoom:parseInt(t.map_params.zoom),styles:[{stylers:[{visibility:"simplified"}]},{elementType:"labels",stylers:[{visibility:"off"}]}]};map=new google.maps.Map(e[0],r),places_service=new google.maps.places.PlacesService(map),set_map_options(map,t),set_map_theme(map,t),set_map_markers(map,t,a),set_map_directions(map,t),set_map_layers(map,t),set_map_places_search(map,t),
//Display places?
"yes"===t.places_api.show_places&&perform_places_search(map,t,a)}//end initialize_map
/**
	 * Set Map Options
	 *
	 * Sets up map controls and theme
	 *
	 */
function set_map_theme(map,map_data){var map_type=map_data.map_theme.map_type.toUpperCase(),map_theme=map_data.map_theme.map_theme_json;map.setOptions(
//Custom (Snazzy) Theme
"ROADMAP"===map_type&&"none"!==map_theme?{mapTypeId:google.maps.MapTypeId.ROADMAP,styles:eval(map_theme)}:{mapTypeId:google.maps.MapTypeId[map_type],styles:!1})}/**
	 * Set Map Options
	 *
	 * Sets up map controls and theme
	 *
	 */
function set_map_options(e,a){
//Zoom control
var o=a.map_controls.zoom_control;e.setOptions("none"===o?{zoomControl:!1}:{zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle[o]}});
//Mouse Wheel Zoom
var t=a.map_controls.wheel_zoom;e.setOptions("none"===t?{scrollwheel:!1}:{scrollwheel:!0});
//Pan Control
var n=a.map_controls.pan_control;e.setOptions("none"===n?{panControl:!1}:{panControl:!0});
//Street View Control
var i=a.map_controls.street_view.toUpperCase();e.setOptions("NONE"===i?{streetViewControl:!1}:{streetViewControl:!0});
//Map Double Click
var r=a.map_controls.double_click_zoom;e.setOptions("none"===r?{disableDoubleClickZoom:!0}:{disableDoubleClickZoom:!1});
//Map Draggable
var s=a.map_controls.draggable;e.setOptions("none"===s?{draggable:!1}:{draggable:!0})}/**
	 * Set Map Markers
	 */
function set_map_markers(map,map_data,info_window){var map_markers=map_data.map_markers;
//Loop through repeatable field of markers
$(map_markers).each(function(index,marker_data){var marker_label="",marker_icon=map_data.map_params.default_marker;//Default marker icon here
//Marker Image Icon
marker_data.marker_img?marker_icon=marker_data.marker_img:"undefined"!=typeof marker_data.marker&&marker_data.marker.length>0&&"undefined"!=typeof marker_data.label&&marker_data.label.length>0&&(marker_icon=eval("("+marker_data.marker+")"),marker_label=marker_data.label);
//Default marker args
var marker_args={position:new google.maps.LatLng(marker_data.lat,marker_data.lng),map:map,zIndex:index,icon:marker_icon,custom_label:marker_label};
//Is sign in enabled? And, do we have a place ID for this marker location?
marker_data.place_id&&"enabled"===map_data.signed_in_option&&(
//Remove unnecessary array params
delete marker_args.position,
//Add Proper Params
marker_args.place={location:{lat:parseFloat(marker_data.lat),lng:parseFloat(marker_data.lng)},placeId:marker_data.place_id},marker_args.attribution={source:map_data.site_name,webUrl:map_data.site_url}),console.log(marker_data.place_id),console.log(map_data.signed_in),console.log(marker_args);
//Marker for map
var location_marker=new Marker(marker_args);
//Opened by default?
if(location_marker.setVisible(!0),google.maps.event.addListener(location_marker,"click",function(){info_window.close(),info_window.setContent('<div id="infobubble-content" class="loading"></div>'),set_info_window_content(marker_data,info_window),info_window.open(map,location_marker)}),"undefined"!=typeof marker_data.infowindow_open&&"opened"==marker_data.infowindow_open){var info_window_opened=new google.maps.InfoWindow({maxWidth:315});set_info_window_content(marker_data,info_window_opened),info_window_opened.open(map,location_marker)}})}/**
	 * Set Infowindow Content
	 *
	 * @description: Queries to get Google Place Details information
	 *
	 * @param marker_data
	 * @param info_window
	 */
function set_info_window_content(e,a){var o;
//Does this marker have a place_id
if(
//place name
e.title&&(o='<p class="place-title">'+e.title+"</p>"),e.description&&(o+='<div class="place-description">'+e.description+"</div>"),e.place_id){var t={key:gmb_data.api_key,placeId:e.place_id};
//Get details from Google on this place
places_service.getDetails(t,function(e,t){t==google.maps.places.PlacesServiceStatus.OK&&(o+=set_place_content_in_info_window(e),o=set_info_window_wrapper(o),//wraps the content in div and returns
a.setContent(o))})}else o=set_info_window_wrapper(o),//wraps the content in div and returns
a.setContent(o)}/**
	 * info_window Content for Place Details
	 *
	 * This marker contains more information about the place
	 *
	 * @param place
	 */
function set_place_content_in_info_window(e){var a;
//additional info wrapper
//place address
//place phone
//place website
//rating
//close wrapper
return a='<div class="marker-info-wrapper">',a+=e.formatted_address?'<div class="place-address">'+e.formatted_address+"</div>":"",a+=e.formatted_phone_number?'<div class="place-phone">'+e.formatted_phone_number+"</div>":"",a+=e.website?'<div class="place-website"><a href="'+e.website+'" target="_blank" rel="nofollow" title="Click to visit the '+e.name+' website">Website</a></div>':"",e.rating&&(a+='<div class="rating-wrap clear"><p class="numeric-rating">'+e.rating+'</p><div class="star-rating-wrap"><div class="star-rating-size" style="width:'+65*e.rating/5+'px;"></div></div></div>'),a+="</div>"}/**
	 * Wrap Info Window Content
	 *
	 * Help function that sets a div container around info window
	 * @param content
	 */
function set_info_window_wrapper(e){var a='<div id="infobubble-content" class="main-place-infobubble-content">';return a+=e,a+="</div>"}/**
	 * Google Places Nearby Search
	 */
function perform_places_search(e,a,o){
//remove existing markers
for(var t=e.getCenter(),n=a.places_api.search_places,i=0;i<search_markers.length;i++)search_markers[i].setMap(null);
//Check if any place types are selected
if(search_markers=[],n.length>0){
//perform search request
var r={key:gmb_data.api_key,location:new google.maps.LatLng(t.lat(),t.lng()),types:n,radius:a.places_api.search_radius};places_service.nearbySearch(r,function(a,t,n){var i,r=0;
//setup new markers
if(t==google.maps.places.PlacesServiceStatus.OK){
//place new markers
for(r=0;i=a[r];r++)create_search_result_marker(e,a[r],o);
//show all pages of results @see: http://stackoverflow.com/questions/11665684/more-than-20-results-by-pagination-with-google-places-api
n.hasNextPage&&n.nextPage()}})}}/**
	 * Create Search Result Marker
	 *
	 * Used with Places Search to place markers on map
	 * @param map
	 * @param place
	 * @param info_window
	 */
function create_search_result_marker(e,a,o){var t=new google.maps.Marker({map:e});
//setup marker icon
t.setIcon(/** @type {google.maps.Icon} */{url:a.icon,size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(24,24)}),t.setPosition(a.geometry.location),t.setVisible(!0),google.maps.event.addListener(t,"click",function(){o.close(),o.setContent('<div id="infobubble-content" class="loading"></div>');var n={title:a.name,place_id:a.place_id};set_info_window_content(n,o),o.open(e,t)}),search_markers.push(t)}/**
	 * Set Map Directions
	 *
	 * @param map
	 * @param map_data
	 */
function set_map_directions(e,a){
//Setup destinations
$(a.destination_markers).each(function(o,t){
//If no points skip
if(!a.destination_markers[0].point||"undefined"==typeof t.point)return!1;var n=new google.maps.DirectionsService,i=new google.maps.DirectionsRenderer;i.setMap(e),"none"!==a.text_directions&&($("#directions-panel-"+a.id).addClass("panel-"+a.text_directions),i.setPanel($("#directions-panel-"+a.id).get(0)));
//Next loop through the groups within
var r=$(this).find(".cmb-repeat-row"),s=t.point[0].latitude,l=t.point[0].longitude,p=t.point[t.point.length-1].latitude,m=t.point[t.point.length-1].longitude,c=t.travel_mode.length>0?t.travel_mode:"DRIVING",_=[];r.not(":first").not(":last").each(function(e,a){var o=$(this).find(".gmb-directions-latitude").val(),t=$(this).find(".gmb-directions-longitude").val();_.push({location:o+","+t,stopover:!0})});var d={origin:s+","+l,destination:p+","+m,waypoints:_,optimizeWaypoints:!0,travelMode:google.maps.TravelMode[c]};n.route(d,function(e,a){a==google.maps.DirectionsStatus.OK&&
//directionsDisplay[index].setOptions( {preserveViewport: true} );
i.setDirections(e)})})}/**
	 * Set Map Layers
	 *
	 * @param map
	 * @param map_data
	 */
function set_map_layers(e,a){var o=new google.maps.TrafficLayer,t=new google.maps.TransitLayer,n=new google.maps.BicyclingLayer;$(a.layers).each(function(a,i){switch(i){case"traffic":o.setMap(e);break;case"transit":t.setMap(e);break;case"bicycle":n.setMap(e)}})}/**
	 * Set Places Search
	 *
	 * @description Adds a places search box that users search for place, addresses, estiblishments, etc.
	 * @param map
	 * @param map_data
	 */
function set_map_places_search(e,a){
// Sets a listener on a radio button to change the filter type on Places
// Autocomplete.
function o(e,a){var o=document.getElementById(e);google.maps.event.addDomListener(o,"click",function(){i.setTypes(a)})}
//sanity check
if("yes"!==a.places_search[0])return!1;{var t=$("#google-maps-builder-"+a.id).siblings(".places-search-wrap"),n=/** @type {HTMLInputElement} */t.find("#pac-input").get(0);$("#google-maps-builder-"+a.id).siblings(".places-search-wrap").find("#type-selector").get(0)}e.controls[google.maps.ControlPosition.TOP_CENTER].push(t.get(0));var i=new google.maps.places.Autocomplete(n);i.bindTo("bounds",e);var r=new google.maps.InfoWindow,s=new google.maps.Marker({map:e,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(i,"place_changed",function(){r.close(),s.setVisible(!1);var a=i.getPlace();if(console.log(a),!a.geometry)return void window.alert("Autocomplete's returned place contains no geometry");
// If the place has a geometry, then present it on a map.
a.geometry.viewport?e.fitBounds(a.geometry.viewport):(e.setCenter(a.geometry.location),e.setZoom(17)),s.setIcon(/** @type {google.maps.Icon} */{url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),s.setPosition(a.geometry.location),s.setVisible(!0);var o;a.name&&(o='<p class="place-title">'+a.name+"</p>"),o+=set_place_content_in_info_window(a),o=set_info_window_wrapper(o),//wraps the content in div and returns
r.setContent(o),//set marker content
r.open(e,s)}),o("changetype-all",[]),o("changetype-address",["address"]),o("changetype-establishment",["establishment"]),o("changetype-geocode",["geocode"])}var map,places_service,place,directionsDisplay=[],search_markers=[];/*
	 * Global load function for other plugins / themes to use
	 *
	 * ex: google_maps_builder_load( object );
	 */
window.google_maps_builder_load=function(e){return $(e).hasClass("google-maps-builder")?void initialize_map(e):"invalid Google Maps Builder"},$(document).ready(function(){var e=$(".google-maps-builder");/*
		 * Loop through maps and initialize
		 */
e.each(function(a,o){initialize_map($(e[a]))}),
// fix for bootstrap tabs
$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var a=$(e.target).attr("href");load_hidden_map(a)})})}(jQuery);