/**
 * Google Maps CPT Handling
 *
 * Nice Demos:
 * https://developers.google.com/maps/documentation/javascript/examples/geocoding-simple
 *
 */
var gmb_data;!function($){"use strict";/**
	 * Place marker on Map on Click
	 *
	 * @param lat_lng
	 * @param event
	 */
function drop_marker(e,a){var t=e.lat(),o=e.lng();
//hide any tentative markers already in place
"undefined"!=typeof i&&i.setVisible(!1),$(".drop-marker").removeClass("active").text("Drop a Marker"),//reset drop button
map.setOptions({draggableCursor:null}),//reset cursor
google.maps.event.removeListener(a);//remove map click event
//add marker at clicked location
var i=new Marker({position:e,map:map,icon:gmb_data.default_marker,zIndex:google.maps.Marker.MAX_ZINDEX+1,optimized:!1}),n=get_marker_index();
//add data to fields
$("#gmb_markers_group_"+n+"_title").val("Point "+n),$("#gmb_markers_group_"+n+"_lat").val(t),$("#gmb_markers_group_"+n+"_lng").val(o),get_editable_info_window(n,i),google.maps.event.addListener(i,"click",function(){get_info_window_content(n,i)})}/**
	 * Map Intialize
	 *
	 * Sets up and configures the Google Map
	 *
	 * @param map_canvas
	 */
function initialize_map(e){lat_field=$("#gmb_lat_lng-latitude"),lng_field=$("#gmb_lat_lng-longitude");var a=lat_field.val()?lat_field.val():"",t=lng_field.val()?lng_field.val():"";zoom=parseInt($("#gmb_zoom").val()),lat_lng=new google.maps.LatLng(a,t);var o={zoom:zoom,streetViewControl:!1,styles:[{stylers:[{visibility:"simplified"}]},{elementType:"labels",stylers:[{visibility:"off"}]}]};
//Setup Autocomplete field if undefined
if(map=new google.maps.Map(e[0],o),window.map=map,places_service=new google.maps.places.PlacesService(map),
//Handle Map Geolocation
navigator.geolocation&&"yes"===gmb_data.geolocate_setting&&""==t&&""==a?navigator.geolocation.getCurrentPosition(function(e){initial_location=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),map.setCenter(initial_location),//set map with location
lat_field.val(e.coords.latitude),//set lat field
lng_field.val(e.coords.longitude)}):""!==a&&""!==t?
//set map with saved lat/lng
map.setCenter(new google.maps.LatLng(a,t)):(initial_location=new google.maps.LatLng(gmb_data.default_lat,gmb_data.default_lng),lat_field.val(gmb_data.default_lat),//set lat field
lng_field.val(gmb_data.default_lng),//set lng field
map.setCenter(initial_location)),
//Set various map view options
set_map_type(!1),"none"!==$("#gmb_theme").val()&&set_map_theme(!1),set_street_view(),set_pan_control(),set_draggable(),set_double_click_zoom(),set_mouse_wheel_scroll(),set_map_type_control(),set_map_zoom_control(),"undefined"==typeof autocomplete){var i=$("#gmb_geocoder");autocomplete=new google.maps.places.Autocomplete(i[0]),autocomplete.bindTo("bounds",map),
//Tame the enter key to not save the widget while using the autocomplete input
google.maps.event.addDomListener(i[0],"keydown",function(e){13==e.keyCode&&e.preventDefault()}),
//Autocomplete event listener
google.maps.event.addListener(autocomplete,"place_changed",function(){
//Clear autocomplete input value
//get place information
//set lat lng input values
return i.one("blur",function(){i.val("")}),setTimeout(function(){i.val("")},10),"undefined"!=typeof tentative_location_marker&&tentative_location_marker.setVisible(!1),place=autocomplete.getPlace(),lat_field.val(place.geometry.location.lat()),lng_field.val(place.geometry.location.lng()),place.geometry?(map.setCenter(place.geometry.location),void add_tentative_marker(map,place.place_id)):void alert("Error: Place not found!")})}
//InfoBubble - Contains the place's information and content
info_bubble=new google.maps.InfoWindow({maxWidth:315}),/**
		 * Map Event Listeners
		 */
//map loaded fully (fires once)
google.maps.event.addListenerOnce(map,"idle",function(){handle_map_zoom(map),add_markers(map),
//toggle places
"undefined"!=typeof $(".cmb2-id-gmb-show-places input:radio").prop("checked")&&"yes"===$(".cmb2-id-gmb-show-places input:radio:checked").val()&&perform_places_search()}),
//map Zoom Changed
google.maps.event.addListener(map,"zoom_changed",function(){handle_map_zoom(map)}),
//Update lng and lat on map drag
google.maps.event.addListener(map,"dragend",function(){var e=map.getCenter();$(".lat-lng-change-message").slideDown(),$(".lat-lng-update-btn").attr("data-lat",e.lat()),$(".lat-lng-update-btn").attr("data-lng",e.lng())})}//end initialize_map
/**
	 * Shows a Marker when Autocomplete search is used
	 * @param map
	 * @param place_id
	 */
function add_tentative_marker(e,a){var t=e.getCenter();
//Marker for map
tentative_location_marker=new google.maps.Marker({map:e,title:"Map Icons",animation:google.maps.Animation.DROP,position:new google.maps.LatLng(t.lat(),t.lng()),icon:new google.maps.MarkerImage(gmb_data.plugin_url+"assets/img/temp-marker.png"),zIndex:google.maps.Marker.MAX_ZINDEX+1,optimized:!1});
//EVENTS
var o=google.maps.event.addListener(tentative_location_marker,"mouseover",function(e){add_circle(a)}),i=google.maps.event.addListener(tentative_location_marker,"mouseout",function(e){hover_circle.setVisible(!1)});
//location clicked
google.maps.event.addListener(tentative_location_marker,"click",function(){
//remove event listeners
google.maps.event.removeListener(o),google.maps.event.removeListener(i),
//show circle
hover_circle.setVisible(!0),
//update marker icons
//Get initial place details from place_id
add_tenative_info_window(a,tentative_location_marker)}),
//Update map with marker position according to lat/lng
tentative_location_marker.setVisible(!0),e.setZoom(zoom)}/**
	 * Set the editable marker window content
	 */
function add_tenative_info_window(e,a){var t={key:gmb_data.api_key,placeId:e};places_service.getDetails(t,function(e,t){if(t==google.maps.places.PlacesServiceStatus.OK){var o=e.geometry.location.lat(),i=e.geometry.location.lng(),n='<p class="place-title">'+e.name+"</p>";n+=add_place_content_to_info_window(e),n+='<div class="infowindow-toolbar clear"><a href="#" class="add-marker" data-title="'+e.name+'" data-place_id="'+e.place_id+'"  data-lat="'+o+'" data-lng="'+i+'">Add to Map</a></div>',n=set_info_window_wrapper(n),//wraps the content in div and returns
info_bubble.setContent(n),//sets the info window content
info_bubble.open(map,a),//opens the info window
//close info window button
google.maps.event.addListener(info_bubble,"closeclick",function(){
//Get initial place details from place_id
hover_circle.setVisible(!1)})}})}/**
	 * info_bubble Content for Place Details
	 *
	 * This marker contains more information about the place
	 *
	 * @param place
	 */
function add_place_content_to_info_window(e){var a;
//additional info wrapper
//place address
//place phone
//place website
//rating
//close wrapper
return a='<div class="marker-info-wrapper">',a+=e.formatted_address?'<div class="place-address">'+e.formatted_address+"</div>":"",a+=e.formatted_phone_number?'<div class="place-phone">'+e.formatted_phone_number+"</div>":"",a+=e.website?'<div class="place-website"><a href="'+e.website+'" target="_blank" rel="nofollow" title="Click to visit the '+e.name+' website">Website</a></div>':"",e.rating&&(a+='<div class="rating-wrap clear"><p class="numeric-rating">'+e.rating+'</p><div class="star-rating-wrap"><div class="star-rating-size" style="width:'+65*e.rating/5+'px;"></div></div></div>'),a+="</div>"}/**
	 * info_bubble Content for Place Details
	 *
	 * This marker contains more information about the place
	 */
function get_editable_info_window(index,marker){info_bubble.close(),info_bubble.setContent('<div id="infobubble-content" class="loading"></div>'),info_bubble.open(map,marker);var info_window_data=get_info_window_saved_data(index),info_window_content;
//default title
info_window_data.title||(info_window_data.title="Point "+index),
//place name
info_window_data.title&&(info_window_content='<input class="edit-place-title" data-field="#gmb_markers_group_'+index+'_title" type="text" value="'+info_window_data.title+'">'),info_window_content+=info_window_data.desc?'<textarea class="edit-place-description" data-field="#gmb_markers_group_'+index+'_description">'+info_window_data.desc+"</textarea>":'<textarea class="edit-place-description" data-field="#gmb_markers_group_'+index+'_description" placeholder="Point Description"></textarea>',
//info_window_content += add_place_content_to_info_window( place );
//toolbar
info_window_content+='<div class="infowindow-toolbar clear"><ul id="save-toolbar"><li class="info-window-save"><div class="google-btn-blue google-btn google-save-btn" data-tooltip="Save changes" data-index="'+index+'">Save</div></li><li class="info-window-cancel"><div class="google-btn-default google-btn google-cancel-btn" data-tooltip="Cancel edit" data-index="'+index+'">Cancel</div></li></ul><span class="marker-edit-link-wrap" data-index="'+index+'"><a href="#marker-icon-modal" data-tooltip="Change icon"  data-mfp-src="#marker-icon-modal" class="marker-edit-link gmb-magnific-marker gmb-magnific-inline"></a></span></div>',info_window_content=set_info_window_wrapper(info_window_content),info_bubble.setContent(info_window_content),initialize_tooltips(),//refresh tooltips
//Save info window content
google.maps.event.addDomListener($(".google-save-btn")[0],"click",function(){
//take info window vals and save to markers' repeatable group
var e=$(".edit-place-title").data("field"),a=$(".edit-place-title").val(),t=$(".edit-place-description").data("field"),o=$(".edit-place-description").val();$(e).val(a),$(t).val(o),
//close info window and remove marker circle
get_info_window_content($(this).data("index"),marker),google.maps.event.removeListener(save_icon_listener),//remove this event listener
google.maps.event.removeListener(edit_marker_icon_button_click)}),
//Close Click
google.maps.event.addDomListener(info_bubble,"closeclick",function(){google.maps.event.removeListener(save_icon_listener),//remove this event listener
google.maps.event.removeListener(edit_marker_icon_button_click)}),
//Cancel info window content
google.maps.event.addDomListener($(".google-cancel-btn")[0],"click",function(){
//close info window and remove marker circle
get_info_window_content($(this).data("index"),marker),google.maps.event.removeListener(save_icon_listener),//remove this event listener
google.maps.event.removeListener(edit_marker_icon_button_click)});
//Infowindow pin icon click to open magnific modal
var edit_marker_icon_button_click=google.maps.event.addDomListener($(".marker-edit-link-wrap")[0],"click",function(){$(".save-marker-button").attr("data-marker-index",$(this).data("index"))}),save_icon_listener=google.maps.event.addDomListener($(".save-marker-button")[0],"click",function(e){e.preventDefault();var marker_position=marker.getPosition(),marker_icon_data,marker_icon=$(this).data("marker"),marker_icon_color=$(this).data("marker-color"),label_color=$(this).data("label-color"),marker_label_inline_style="color:"+label_color+"; ";"MAP_PIN"===marker_icon?marker_label_inline_style+="font-size: 20px;position: relative; top: -3px;":"SQUARE_PIN"==marker_icon&&(marker_label_inline_style+="font-size: 20px;position: relative; top: 12px;");
//collect marker data from submit button
var marker_label_data='<i class="'+$(this).data("label")+'" style="'+marker_label_inline_style+'"></i>';
//Set marker icon data
""==marker_icon?(
//default icon
marker_icon_data=gmb_data.default_marker,$("#gmb_markers_group_"+index+"_marker").val(""),marker_label_data=""):(
//maps-icon
marker_icon_data="{ path : "+marker_icon+', fillColor : "'+marker_icon_color+'", fillOpacity : 1, strokeColor : "", strokeWeight: 0, scale : 1 / 3 }',$("#gmb_markers_group_"+index+"_marker").val(marker_icon_data),marker_icon_data=eval("("+marker_icon_data+")")),
//remove current marker
marker.setMap(null),
//Update fields with necessary data
$("#gmb_markers_group_"+index+"_label").val(marker_label_data),
//Update Icon
marker=new Marker({position:marker_position,map:map,zIndex:9,icon:marker_icon_data,custom_label:marker_label_data}),
//Add event listener to new marker
google.maps.event.addListener(marker,"click",function(){get_info_window_content(index,marker)}),
//Clean up modal and close
$(".icon, .marker-item").removeClass("marker-item-selected"),//reset modal
$(".marker-icon-row, .save-marker-icon, .marker-icon-color-wrap, .marker-label-color-wrap").hide(),//reset modal
$(this).removeData("marker"),//Remove data
$(this).removeData("marker-color"),//Remove data
$(this).removeData("label"),//Remove data
$(this).removeData("label-color"),//Remove data
0===$(".magnific-builder").length&&$.magnificPopup.close(),google.maps.event.removeListener(save_icon_listener),//remove this event listener
google.maps.event.removeListener(edit_marker_icon_button_click)})}/**
	 * Wrap Info Window Content
	 *
	 * Help function that sets a div container around info window
	 * @param content
	 */
function set_info_window_wrapper(e){var a='<div id="infobubble-content" class="main-place-infobubble-content">';return a+=e,a+="</div>"}/**
	 * Adds a marker circle
	 */
function add_circle(e){hover_circle=new google.maps.Marker({position:tentative_location_marker.getPosition(),zIndex:google.maps.Marker.MAX_ZINDEX-1,optimized:!1,icon:{path:google.maps.SymbolPath.CIRCLE,scale:20,strokeWeight:3,strokeOpacity:.9,strokeColor:"#FFF",fillOpacity:.3,fillColor:"#FFF"},map:map}),google.maps.event.addListener(hover_circle,"click",function(){
//Get initial place details from place_id
add_tenative_info_window(e,tentative_location_marker)}),google.maps.event.addListener(tentative_location_marker,"click",function(){
//Get initial place details from place_id
hover_circle.setVisible(!0)})}/**
	 *  Add Markers
	 *
	 * This is the marker that first displays on load for the main location or place
	 *
	 * @param map
	 */
function add_markers(map){clear_main_markers(),
//Loop through repeatable field of markers
$("#gmb_markers_group_repeat .cmb-repeatable-grouping").each(function(index){var marker_icon=gmb_data.default_marker,marker_label="",custom_marker_icon=$("#gmb_markers_group_"+index+"_marker").val();custom_marker_icon.length>0&&(marker_icon=eval("("+custom_marker_icon+")"));var custom_label=$("#gmb_markers_group_"+index+"_label").val();custom_label.length>0&&(marker_label=custom_label);
//Marker for map
var location_marker=new Marker({map:map,zIndex:9,icon:marker_icon,custom_label:marker_label}),marker_lat=$("#gmb_markers_group_"+index+"_lat").val(),marker_lng=$("#gmb_markers_group_"+index+"_lng").val();location_marker.setPosition(new google.maps.LatLng(marker_lat,marker_lng)),location_marker.setVisible(!0),google.maps.event.addListener(location_marker,"click",function(){get_info_window_content(index,location_marker)})})}function get_info_window_saved_data(e){var a=new Object;return a.title=$("#gmb_markers_group_"+e+"_title").val(),a.desc=$("#gmb_markers_group_"+e+"_description").val(),a.reference=$("#gmb_markers_group_"+e+"_reference").val(),a.place_id=$("#gmb_markers_group_"+e+"_place_id").val(),a.lat=$("#gmb_markers_group_"+e+"_lat").val(),a.lng=$("#gmb_markers_group_"+e+"_lng").val(),a}/**
	 * Queries to get Google Place Details information
	 *
	 * Help function
	 * @param index
	 * @param marker
	 */
function get_info_window_content(e,a){info_bubble.close(),info_bubble.setContent('<div id="infobubble-content" class="loading"></div>'),info_bubble.open(map,a);var t,o=get_info_window_saved_data(e);
//Show place information within info bubble
if(o.place_id){var i={key:gmb_data.api_key,placeId:o.place_id};places_service.getDetails(i,function(i,n){n==google.maps.places.PlacesServiceStatus.OK&&(
//place name
t='<p class="place-title">'+o.title+"</p>",t+='<div class="place-description">'+o.desc+"</div>",t+=add_place_content_to_info_window(i),
//toolbar
t+='<div class="infowindow-toolbar"><ul id="edit-toolbar"><li class="edit-info" data-index="'+e+'" data-tooltip="Edit Marker"></li><li class="trash-marker" data-index="'+e+'" data-tooltip="Delete Marker"></li></ul></div>',add_edit_events(t,a))})}else
//Only show saved data (no place lookup)
//place name
t='<p class="place-title">'+o.title+"</p>",t+='<div class="place-description">'+o.desc+"</div>",
//toolbar
t+='<div class="infowindow-toolbar"><ul id="edit-toolbar"><li class="edit-info" data-index="'+e+'" data-tooltip="Edit Marker"></li><li class="trash-marker" data-index="'+e+'" data-tooltip="Delete Marker"></li></ul></div>',add_edit_events(t,a)}/**
	 * Add Edit Events
	 *
	 * Sets up Google Map event listeners and other setup for info bubbles
	 *
	 * @param content
	 * @param marker
	 */
function add_edit_events(e,a){e=set_info_window_wrapper(e),//wraps the content in div and returns
info_bubble.setContent(e),//set infowindow content
initialize_tooltips(),//refresh tooltips
//edit button event
google.maps.event.addDomListener($(".edit-info")[0],"click",function(){
//Edit Marker
get_editable_info_window($(this).data("index"),a)}),
//trash button event
google.maps.event.addDomListener($(".trash-marker")[0],"click",function(){var e=$(this).data("index");
//if first item clear out all input values
0===e&&$('div[data-iterator="'+e+'"] ').find("input,textarea").val(""),
//trigger remove row button click for this specific markers row
$('div[data-iterator="'+e+'"] .remove-group-row').trigger("click"),
//close info window and remove marker
info_bubble.close(),a.setVisible(!1)})}/**
	 * Marker Index
	 *
	 * Helper function that returns the appropriate index for the repeatable group
	 *
	 */
function get_marker_index(){
//Create a new marker repeatable meta group
var e=parseInt($("#gmb_markers_group_repeat div.cmb-repeatable-grouping").last().attr("data-iterator")),a=$('div[data-iterator="0"] ').find("input,textarea").val();
//Ensure appropriate index is used for marker
//recount rows
return a&&0===e?($(".cmb-add-group-row.button").trigger("click"),e=1):0!==e&&($(".cmb-add-group-row.button").trigger("click"),e=parseInt($("#gmb_markers_group_repeat div.cmb-repeatable-grouping").last().attr("data-iterator"))),e}/**
	 * Google Places Marker Info Window
	 *
	 * @param place
	 * @param marker
	 */
function get_place_info_window_content(e,a){info_bubble.setContent('<div id="infobubble-content" class="loading"></div>'),info_bubble.open(map,a);var t={key:gmb_data.api_key,placeId:e.place_id};places_service.getDetails(t,function(e,a){if(a==google.maps.places.PlacesServiceStatus.OK){var t;
//place name
t='<p class="place-title">'+e.name+"</p>",t+=add_place_content_to_info_window(e),t=set_info_window_wrapper(t),//wraps the content in div and returns
info_bubble.setContent(t),initialize_tooltips()}else
//There was an API error; display it for the user:
info_bubble.setContent('<p class="place-error">Google API Error: '+a+"</p>")})}/**
	 * Get Places Types Array
	 *
	 * Loops through checkboxes and returns array of checked values
	 *
	 * @returns get_places_type
	 */
function get_places_type_array(){var e=[];return $('.cmb2-id-gmb-places-search-multicheckbox input[type="checkbox"]').each(function(){$(this).is(":checked")&&e.push($(this).val())}),e}/**
	 * Google Places Nearby Search
	 *
	 */
function perform_places_search(){$(".places-loading").fadeIn(),$(".warning-message").hide().empty();var e=get_places_type_array();
//Check if any place types are selected
if(clear_search_markers(),e.length>0){
//perform search request
var a={key:gmb_data.api_key,location:return_lat_lng(),types:e,radius:parseInt($("#gmb_search_radius").val())};places_service.nearbySearch(a,places_search_callback)}else show_warning_message("<strong>Notice: No Place Types are selected</strong><br/> Please select the types of places you would like to display on this map using the Place Type field checkboxes found below.")}/**
	 * Warning Messages
	 *
	 * Helper function that shows a warning message below the google map
	 * @param message
	 */
function show_warning_message(e){$(".wpgp-loading").fadeOut(),//fade out all loading items
$(".warning-message").empty().append("<p>"+e+"</p>").fadeIn()}/**
	 *
	 * Returns Maps current Long and Latitude Object
	 *
	 * Helper Function
	 *
	 * @returns lat_lng
	 */
function return_lat_lng(){var e=map.getCenter(),a=new google.maps.LatLng(e.lat(),e.lng());return a}/**
	 * Map Zoom
	 *
	 * Sets the map zoom field and variable
	 *
	 */
function handle_map_zoom(e){var a=e.getZoom();$("#gmb_zoom").val(a),$("#gmb_zoom").on("change",function(){e.setZoom(parseInt($(this).val()))})}/**
	 * Map Lat Lng
	 *
	 * Sets the map zoom field and variable
	 */
function lat_lng_field_change(e){var a=new google.maps.LatLng($(lat_field).val(),$(lng_field).val());e.panTo(a)}/**
	 * Places Search Callback
	 *
	 * Used to loop through results and call function to create search result markers
	 *
	 * @param results
	 * @param status
	 * @param pagination
	 */
function places_search_callback(e,a,t){var o,i=0;
//setup new markers
if(a==google.maps.places.PlacesServiceStatus.OK){
//place new markers
for(i=0;o=e[i];i++)create_search_result_marker(e[i]);
//show all pages of results
//@see: http://stackoverflow.com/questions/11665684/more-than-20-results-by-pagination-with-google-places-api
t.hasNextPage?t.nextPage():$(".places-loading").fadeOut()}}/**
	 * Create Search Result Marker
	 *
	 * Used with Places Search to place markers on map
	 *
	 * @param place
	 */
function create_search_result_marker(e){var a=new Marker({map:map,zIndex:0,optimized:!1});
//setup marker icon
a.setIcon(/** @type {google.maps.Icon} */{url:e.icon,size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(24,24)}),a.setPosition(e.geometry.location),a.setVisible(!0),google.maps.event.addListener(a,"click",function(){get_place_info_window_content(e,a)}),search_markers.push(a)}/**
	 * Clears Main Markers
	 *
	 * Used to clear out main location marker to prevent from displaying multiple
	 *
	 */
function clear_main_markers(){
//clear markers
for(var e=0;e<location_marker_array.length;e++)location_marker_array[e].setMap(null);
//clear infowindows
for(location_marker_array.length=0,e=0;e<info_bubble_array.length;e++)info_bubble_array[e].close(),google.maps.event.trigger(info_bubble_array[e],"closeclick");info_bubble_array.length=0}/**
	 * Clears Search Markers
	 *
	 * Used to clear out main search markers
	 */
function clear_search_markers(){
//remove existing markers
for(var e=0;e<search_markers.length;e++)search_markers[e].setMap(null);search_markers=[]}/**
	 * Geocode new marker position
	 *
	 * Perform nearby search request to see if the marker landed on a place
	 *
	 * @see: http://stackoverflow.com/questions/5688745/google-maps-v3-draggable-marker
	 * @param pos
	 */
function geocode_position(e){var a={key:gmb_data.api_key,location:e,radius:10};places_service.nearbySearch(a,function(e,a){if(a==google.maps.places.PlacesServiceStatus.OK){var t="";
//if more than one result ask the user which one?
if(info_bubble.close(),e.length>1){t='<div id="infobubble-content"><p>'+gmb_data.string_multiple_places+"</p>";for(var o=0;o<e.length;o++)t+='<a class="marker-confirm-place"  data-place_id="'+e[o].place_id+'" data-name-address="'+e[o].name+", "+e[o].vicinity+'">'+e[o].name+"</a>";t+="</div>",
//setup click event for links
google.maps.event.addDomListener(info_bubble,"domready",function(){$(".marker-confirm-place").on("click",function(e){e.preventDefault(),$("#gmb_geocoder").val($(this).data("name-address")),$("#gmb_place_id").val($(this).data("place_id")),info_bubble.close(),get_info_window_content($(this).data("place_id"))})})}info_bubble.setContent(t),info_bubble.open(map,location_marker)}})}/**
	 * Scroll to Selector
	 *
	 * Helper function that scroll the user up to the map
	 */
function scroll_to_field(e){
//scroll to the map
$("html, body").animate({scrollTop:parseInt($(e).offset().top)},600)}/**
	 * Marker Drag End
	 *
	 * Executes after a user drags the initial marker
	 *
	 * @param marker
	 */
function marker_drag_end(e){var a=e.getPosition();geocode_position(a),
//update with new map coordinates
$(lat_field).val(a.lat()),$(lng_field).val(a.lng()),
//Map centered on this location
map.panTo(a)}/**
	 * Radius Circle
	 *
	 * Draws a circle when user focuses on the radius input
	 *
	 * @see: http://jsfiddle.net/yV6xv/3730/
	 * @param map
	 * @param radiusVal
	 */
function calc_radius(e,a){
//update marker with set marker
radius_marker=new Marker({position:e.getCenter(),map:e,icon:{path:MAP_PIN,fillColor:"#0E77E9",fillOpacity:0,strokeColor:"",strokeWeight:0,scale:.25},custom_label:'<i class="map-icon-crosshairs radius-label"></i>',zIndex:google.maps.Marker.MAX_ZINDEX+1,optimized:!1}),radius_circle=new google.maps.Circle({map:e,fillColor:"#BBD8E9",fillOpacity:.3,radius:a,strokeColor:"#BBD8E9",strokeOpacity:.9,strokeWeight:2}),radius_circle.bindTo("center",radius_marker,"position")}/**
	 * Show/ Hide Map Fields
	 *
	 * Helper function that handles all the toggle elements within the CPT admin post screen
	 *
	 */
function toggle_metabox_fields(){var e=$(".cmb2-id-gmb-show-places input:radio");
//Places Metabox
e.prop("checked")&&($(".cmb2-id-gmb-search-radius").toggle(),$(".cmb2-id-gmb-places-search-multicheckbox").toggle()),
//Nothing checked yet so select 'No' by default
e.prop("checked")||$("#gmb_show_places2").prop("checked",!0),$(".cmb2-id-gmb-show-places li").on("click",function(){$(this).find("input:radio").prop("checked",!0),$(".cmb2-id-gmb-search-radius").toggle(),$(".cmb2-id-gmb-places-search-multicheckbox").toggle(),"no"===$(this).val()?clear_search_markers():perform_places_search()})}/**
	 * Set Zoom Control
	 */
function set_map_zoom_control(){var e=$("#gmb_zoom_control").val().toUpperCase();map.setOptions("NONE"==e?{zoomControl:!1}:{zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle[e]}})}/**
	 * Set Map Type Control
	 */
function set_map_type_control(){var e=$("#gmb_map_type_control").val().toUpperCase();map.setOptions("NONE"==e?{mapTypeControl:!1}:{mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle[e]}})}/**
	 * Sets Mouse Wheel Scroll
	 */
function set_mouse_wheel_scroll(){var e=$("#gmb_wheel_zoom").val();map.setOptions("none"===e?{scrollwheel:!1}:{scrollwheel:!0})}/**
	 * Sets Double Click Zoom on Map
	 */
function set_double_click_zoom(){var e=$("#gmb_double_click").val();map.setOptions("none"===e?{disableDoubleClickZoom:!0}:{disableDoubleClickZoom:!1})}/**
	 * Sets Draggable Map
	 */
function set_draggable(){var e=$("#gmb_draggable").val();map.setOptions("none"==e?{draggable:!1}:{draggable:!0})}/**
	 * Sets the Pan Control
	 */
function set_pan_control(){var e=$("#gmb_pan").val();map.setOptions("none"===e?{panControl:!1}:{panControl:!0})}/**
	 * Sets the Street View Control
	 */
function set_street_view(){var e=$("#gmb_street_view").val();map.setOptions("none"===e?{streetViewControl:!1}:{streetViewControl:!0})}/**
	 * Sets the Map Type
	 *
	 * Changes the Google Map type and resets theme to none
	 */
function set_map_type(e){e===!0&&($("#gmb_theme").val("none"),$("#gmb_theme_json").val("none"));var a=$("#gmb_type").val().toUpperCase();map.setOptions({mapTypeId:google.maps.MapTypeId[a],styles:!1})}/**
	 * Sets the Map Theme
	 *
	 * Uses Snazzy Maps JSON arrow to set the colors for the map
	 *
	 */
function set_map_theme(reset){reset===!0&&($("#gmb_type").val("RoadMap"),$("#gmb_theme_json").val("none"),$(".cmb2-id-gmb-theme-json").hide()),
//AJAX to get JSON data for Snazzy
$.getJSON(gmb_data.snazzy,function(data){var map_theme_input_val=parseInt($("#gmb_theme").val());"none"===$("#gmb_theme").val()?(set_map_type(),$(".cmb2-id-gmb-theme-json").hide()):$(".cmb2-id-gmb-theme-json").show(),$.each(data,function(index){data[index].id===map_theme_input_val&&(map_theme_input_val=eval(data[index].json),$("#gmb_theme_json").val(data[index].json))}),map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP,styles:map_theme_input_val})})}/**
	 * JS for Marker Icon Modal
	 */
function set_map_marker_icon(){
//Marker Item Click
$(".marker-item").on("click",function(){var e=$(this).data("marker");$(".marker-item").removeClass("marker-item-selected"),$(this).addClass("marker-item-selected"),
//default marker
"default"==e?($(".marker-icon-row, .marker-icon-color-wrap, .marker-label-color-wrap").slideUp(),$(".save-marker-icon").slideDown(),$("#marker-icon-modal .save-marker-button").attr("data-marker",""),$("#marker-icon-modal .save-marker-button").attr("data-label","")):(
//custom markers
$(".marker-icon-color-wrap, .marker-icon-row").slideDown(),$("#marker-icon-modal .save-marker-button").attr("data-marker",e))}),
//Icon Click
$(".icon").on("click",function(){$(".icon").removeClass("marker-item-selected"),$(this).addClass("marker-item-selected"),$(".save-marker-icon, .marker-label-color-wrap").slideDown(),//slide down save button
$("#marker-icon-modal .save-marker-button").attr("data-label",$(this).find("span").attr("class"))});/**
		 * Colors
		 */
//Setup colorpickers
var e={
// you can declare a default color here, or in the data-default-color attribute on the input
// a callback to fire whenever the color changes to a valid color
change:function(e,a){var t=a.color.toString();
//Marker Color
$(this).hasClass("marker-color")===!0?($(".save-marker-button").attr("data-marker-color",t),$(".marker-svg polygon, .marker-svg path").attr("fill",t)):$(this).hasClass("label-color")===!0&&($(".save-marker-button").attr("data-label-color",t),$(".icon-inner span").css("color",t))},
// a callback to fire when the input is emptied or an invalid color
clear:function(){},
// hide the color picker controls on load
hide:!0,
// show a group of common colors beneath the square
// or, supply an array of colors to customize further
palettes:!0};$(".color-picker").wpColorPicker(e)}/**
	 * Refresh Tooltips
	 *
	 * Helper function to refresh tooltips when elements added dynamically to DOM
	 */
function initialize_tooltips(){$('[data-tooltip!=""]').qtip({// Grab all elements with a non-blank data-tooltip attr.
content:{attr:"data-tooltip"},hide:{fixed:!0,delay:100},position:{my:"top center",at:"bottom center"},style:{classes:"qtip-tipsy"},show:{when:{event:"focus"},effect:function(){$(this).fadeIn(200)}}}),
//Initialize Magnific Too
$(".gmb-magnific-inline").on("click",function(){
//Modal in modal?
if($.magnificPopup.instance.isOpen===!0){
//We can't have a magnific inside magnific so CSS3 modal it is
var e=$(this).attr("href");
//Open CSS modal
$(e).before('<div class="modal-placeholder"></div>').removeClass("mfp-hide").appendTo(".magnific-builder #poststuff"),// Move the element to container
//Add close functionality
$(".magnific-builder .white-popup").on("click",function(e){"white-popup"===e.target.className&&
// Move back out of container
$(this).appendTo(".modal-placeholder").unwrap()}),
//Close button
$(".magnific-builder .button-primary").on("click",function(){$(this).parents(".white-popup").appendTo(".modal-placeholder").unwrap()})}else $.magnificPopup.open({items:{src:$("#marker-icon-modal"),type:"inline"},midClick:!0})})}/**
	 * Window Load functions
	 */
$(window).load(function(){toggle_metabox_fields(),
//tooltips
initialize_tooltips(),
//Map type Metabox on load
initialize_map($("#map")),
//Latitude on Change
$("#gmb_lat_lng-latitude").on("change",function(){lat_lng_field_change(map)}),
//Longitude on Change
$("#gmb_lat_lng-longitude").on("change",function(){lat_lng_field_change(map)}),
//click to add marker
$(".drop-marker").on("click",function(e){if(e.preventDefault(),$(this).hasClass("active"))$(this).text("Drop a Marker").removeClass("active"),map.setOptions({draggableCursor:null});else{$(this).text("Click on the Map").addClass("active"),map.setOptions({draggableCursor:"crosshair"});var a=google.maps.event.addListener(map,"click",function(e){drop_marker(e.latLng,a)})}});
//Radius Fields
var e;
//Search Radius Circle
$("#gmb_search_radius").on("focus",function(){e=$(this).val(),calc_radius(map,parseInt($(this).val()))}).focusout(function(){e!==$(this).val()&&perform_places_search(),radius_circle.setMap(null),//removes circle on focus out
radius_marker.setMap(null)}),
//Places Type Field
$('[name^="gmb_places_search_multicheckbox"]').on("change",function(){
//Show message if not already displayed
0===$(".places-change-message").length&&($(".cmb2-id-gmb-places-search-multicheckbox ul").prepend('<div class="wpgp-message places-change-message clear"><p>Place selections have changed.</p><a href="#" class="button update-places-map">Update Map</a></div>'),$(".places-change-message").slideDown())}),$(".cmb-multicheck-toggle").on("click",function(){0===$(".places-change-message").length&&($(".cmb2-id-gmb-places-search-multicheckbox ul").prepend('<div class="wpgp-message places-change-message clear"><p>Place selections have changed.</p><a href="#" class="button update-places-map">Update Map</a></div>'),$(".places-change-message").slideDown())}),
//Places Update Map Button
$(document).on("click",".update-places-map",function(e){e.preventDefault(),scroll_to_field("#google_maps_preview_metabox"),perform_places_search(),$(this).parent().fadeOut(function(){$(this).remove()})}),
//Update lat lng message
$(".lat-lng-update-btn").on("click",function(e){e.preventDefault(),$(".lat-lng-change-message").slideUp(),$("#gmb_lat_lng-latitude").val($(this).attr("data-lat")),$("#gmb_lat_lng-longitude").val($(this).attr("data-lng"))}),
//Add New Marker
$(document).on("click",".add-marker",function(e){e.preventDefault(),hover_circle.setVisible(!1);
//update marker with set marker
var a=new google.maps.Marker({position:tentative_location_marker.getPosition(),map:map,icon:gmb_data.default_marker,zIndex:google.maps.Marker.MAX_ZINDEX+1,optimized:!1});
//hide tentative green marker
tentative_location_marker.setVisible(!1);
//get current number of repeatable rows ie markers
var t=get_marker_index(),o=$(this).data("place_id");
//add data to fields
get_editable_info_window(t,a),$('input[data-field="#gmb_markers_group_'+t+'_title"]').val($(this).data("title")),$("input#gmb_markers_group_"+t+"_lat").val($(this).data("lat")),$("input#gmb_markers_group_"+t+"_lng").val($(this).data("lng")),$("input#gmb_markers_group_"+t+"_place_id").val(o),
//location clicked
google.maps.event.addListener(a,"click",function(){get_info_window_content(t,a)})}),
//Map Marker Set
set_map_marker_icon(),
//Map Type
$("#gmb_type").change(function(){set_map_type(!0)}),
//Map Theme
$("#gmb_theme").change(function(){set_map_theme(!0)}),
//street view
$("#gmb_street_view").change(function(){set_street_view()}),
//Pan
$("#gmb_pan").change(function(){set_pan_control()}),
//Draggable
$("#gmb_draggable").change(function(){set_draggable()}),
//Double Click Zoom
$("#gmb_double_click").change(function(){set_double_click_zoom()}),
//Double Click Zoom
$("#gmb_wheel_zoom").change(function(){set_mouse_wheel_scroll()}),
//Map Type Control
$("#gmb_map_type_control").change(function(){set_map_type_control()}),
//Zoom Control
$("#gmb_zoom_control").change(function(){set_map_zoom_control()}),
//Close repeaters
$("#gmb_markers_group_repeat .cmb-repeatable-grouping").addClass("closed"),
//Add Repeater toggle button
$(".toggle-repeater-groups").on("click",function(e){e.preventDefault(),$("#gmb_markers_group_repeat .cmb-repeatable-grouping").toggleClass("closed")}),
//Window resize
$(window).on("resize",function(){
//Ensure window resizes triggers map resize
google.maps.event.trigger(map,"resize")})});//End Window Load
var map,places_service,lat_lng,zoom,lat_field,lng_field,radius_circle,radius_marker,place,autocomplete,info_bubble,info_bubble_array=[],tentative_location_marker,location_marker,location_marker_array=[],search_markers=[],hover_circle,initial_location,delay=function(){var e=0;return function(a,t){clearTimeout(e),e=setTimeout(a,t)}}()}(jQuery);